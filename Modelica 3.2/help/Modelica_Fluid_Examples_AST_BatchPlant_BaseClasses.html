<HTML>
<HEAD>
<TITLE>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</TITLE>
<META name="HTML-Generator" content="Dymola">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal}
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE BaseClasses<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant.html#Modelica.Fluid.Examples.AST_BatchPlant"
>Modelica.Fluid.Examples.AST_BatchPlant</A>.BaseClasses</H2>
<P><H3>Information</H3></P>
Extends from <A HREF="Modelica_Icons_BasesPackage.html#Modelica.Icons.BasesPackage"
>Modelica.Icons.BasesPackage</A> (Icon for packages containing base classes).
<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoidS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoid" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoid"
>TriggeredTrapezoid</A>
</TD><TD>Triggered trapezoid generator</TD></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setRealS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setReal" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setReal"
>setReal</A>
</TD><TD>Set output signal to a time varying Real expression</TD></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensorS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor"
>TankWith3InletOutletArraysWithEvaporatorCondensor</A>
</TD><TD>Tank with Heating and Evaporation</TD></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTankS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank"
>InnerTank</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Controller" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Controller"
>Controller</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilitiesS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses_ControllerUtilities.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities"
>ControllerUtilities</A>
</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init"
>Init</A>
</TD><TD>Enumeration to define initialization options</TD></TR>
<TR><TD><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPortsS.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts"
>TankWithTopPorts</A>
</TD><TD>Tank with inlet/outlet ports and with inlet ports at the top</TD></TR>
</TABLE>
<P><H3>Types and constants</H3>
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init"></A><PRE>  <font color="blue">type</font> Init = <font color="blue">enumeration</font>(
    GuessValues <font color="darkgreen">&quot;GuessValues -- Guess values (not fixed) for p, T or h, X, C&quot;</font>,
    InitialValues <font color="darkgreen">&quot;InitialValues -- Initial values for p, T or h, X, C&quot;</font>,
    SteadyStateMomentum <font color="darkgreen">&quot;SteadyStateMomentum: Steady state momentum&quot;</font>,
    SteadyStateHydraulic <font color="darkgreen">
      &quot;SteadyStateHydraulic -- Hydraulic steady state (der(p)=0), guess value for p, initial values for T or h, X, C&quot;</font>,

    SteadyState <font color="darkgreen">
      &quot;SteadyState -- Steady state (guess values for p, T or h, X, C)&quot;</font>) <font color="darkgreen">
  &quot;Enumeration to define initialization options&quot;</font>;</PRE><p>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE TriggeredTrapezoid<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoidI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoid" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoid"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</A>.TriggeredTrapezoid</H2>
<B>Triggered trapezoid generator</B><p>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoidD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TriggeredTrapezoid">
<P><H3>Information</H3></P>
<PRE></pre>
<p>The block TriggeredTrapezoid has a boolean input and a real
output signal and requires the parameters <i>amplitude</i>,
<i>rising</i>, <i>falling</i> and <i>offset</i>. The
output signal <b>y</b> represents a trapezoidal signal dependent on the
input signal <b>u</b>.
</p>
<p>The behaviour is as follows: Assume the initial input to be false. In this
case, the output will be <i>offset</i>. After a rising edge (i.e., the input
changes from false to true), the output is rising during <i>rising</i> to the
sum of <i>offset</i> and <i>amplitude</i>. In contrast, after a falling
edge (i.e., the input changes from true to false), the output is falling
during <i>falling</i> to a value of <i>offset</i>.
</p>
<p>Note, that the case of edges before expiration of rising or falling is
handled properly.</p>
<pre>
</PRE><P>
Extends from <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.partialBooleanBlockIcon"
>Modelica.Blocks.Interfaces.partialBooleanBlockIcon</A> (Basic graphical layout of logical block).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>amplitude</TD><TD>1</TD><TD>Amplitude of trapezoid</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>rising</TD><TD>0</TD><TD>Rising duration of trapezoid [s]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Time"
>Time</A></TD><TD>falling</TD><TD>rising</TD><TD>Falling duration of trapezoid [s]</TD></TR>
<TR><TD>Real</TD><TD>offset</TD><TD>0</TD><TD>Offset of output signal</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>input <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanInput"
>BooleanInput</A></TD><TD>u</TD><TD>Connector of Boolean input signal</TD></TR>
<TR><TD>output <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>RealOutput</A></TD><TD>y</TD><TD>Connector of Real output signal</TD></TR>
<TR><TD>output <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanOutput"
>BooleanOutput</A></TD><TD>y_high</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> TriggeredTrapezoid <font color="darkgreen">&quot;Triggered trapezoid generator&quot;</font>
  <font color="blue">extends </font><A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.partialBooleanBlockIcon"
>Modelica.Blocks.Interfaces.partialBooleanBlockIcon</A>;

  <font color="blue">parameter </font>Real amplitude=1 <font color="darkgreen">&quot;Amplitude of trapezoid&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> rising(<font color="blue">final </font>min=0)=0 <font color="darkgreen">
    &quot;Rising duration of trapezoid&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> falling(<font color="blue">final </font>min=0)=rising <font color="darkgreen">
    &quot;Falling duration of trapezoid&quot;</font>;
  <font color="blue">parameter </font>Real offset=0 <font color="darkgreen">&quot;Offset of output signal&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanInput"
>Modelica.Blocks.Interfaces.BooleanInput</A> u <font color="darkgreen">&quot;Connector of Boolean input signal&quot;</font>;
  <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealOutput"
>Modelica.Blocks.Interfaces.RealOutput</A> y <font color="darkgreen">&quot;Connector of Real output signal&quot;</font>;</textblock>

<font color="blue">protected </font>
  <font color="blue">discrete </font>Real endValue <font color="darkgreen">&quot;Value of y at time of recent edge&quot;</font>;
  <font color="blue">discrete </font>Real rate <font color="darkgreen">&quot;Current rising/falling rate&quot;</font>;
  <font color="blue">discrete </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Time"
>Modelica.SIunits.Time</A> T <font color="darkgreen">&quot;Predicted time of output reaching endValue&quot;</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">public </font>
  <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.BooleanOutput"
>Modelica.Blocks.Interfaces.BooleanOutput</A> y_high;</textblock>
<font color="blue">initial </font><font color="blue">equation </font>
  <font color="darkgreen">/* A start value of y is set, because pre(y) is present
     to avoid a warning message from the compiler. However,
     this setting does not have an effect, because y is initialized
     correctly, before pre(y) is used
  */</font>
  <font color="red">pre</font>(y) = 0;
<font color="blue">equation </font>
    y_high = time &lt; T;
    y = <font color="blue">if </font>y_high<font color="blue"> then </font>endValue - (T - time)*rate<font color="blue"> else </font> endValue;

    <font color="blue">when </font>{<font color="red">initial</font>(),u,<font color="blue">not </font>u}<font color="blue"> then</font>
      endValue = <font color="blue">if </font>u<font color="blue"> then </font>offset + amplitude<font color="blue"> else </font>offset;
      rate = <font color="blue">if </font>u<font color="blue"> and </font>(rising &gt; 0)<font color="blue"> then </font>amplitude/rising<font color="blue"> else </font>
        <font color="blue">if </font><font color="blue">not </font>u<font color="blue"> and </font>(falling &gt; 0)<font color="blue"> then </font>-amplitude/falling<font color="blue"> else </font>0;
      T = <font color="blue">if </font>u<font color="blue"> and </font><font color="blue">not </font>(rising &gt; 0)<font color="blue"> or </font><font color="blue">not </font>u<font color="blue"> and </font><font color="blue">not </font>(falling
         &gt; 0)<font color="blue"> or </font><font color="blue">not </font><font color="red">abs</font>(amplitude) &gt; 0<font color="blue"> or </font><font color="red">initial</font>()<font color="blue"> then </font>time<font color="blue"> else </font>time
         + (endValue -<font color="red"> pre</font>(y))/rate;
    <font color="blue">end when</font>;
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>TriggeredTrapezoid;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE setReal<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setRealI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setReal" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setReal"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</A>.setReal</H2>
<B>Set output signal to a time varying Real expression</B><p>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setRealD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.setReal">
<P><H3>Information</H3></P>
<PRE></pre>

<pre></PRE><P>

<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Time varying input signal</TD></TR>
<TR><TD><A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>&nbsp;</TD><TD>Set value of Real input</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=3>Time varying input signal</TD></TR>
<TR><TD>input <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>RealInput</A></TD><TD>u</TD><TD>Set value of Real input</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">block</font> setReal <font color="darkgreen">&quot;Set output signal to a time varying Real expression&quot;</font>

<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> u <font color="darkgreen">&quot;Set value of Real input&quot;</font>;</textblock>

<textblock type="annotcomp" expanded="false">
<font color="blue">end </font>setReal;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE TankWith3InletOutletArraysWithEvaporatorCondensor<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensorI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</A>.TankWith3InletOutletArraysWithEvaporatorCondensor</H2>
<B>Tank with Heating and Evaporation</B><p>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensorD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor">
<P><H3>Information</H3></P>
<PRE></pre>
<p>This tank has the same geometric variables as TankWith3InletOutletArrays plus the feature of a HeatPort and the possibility of evaporation.
(Assumption: The gas is condensed emidiatly afterwards so that a liquid boiling fluid is created.)</p>
<p>The tank can be initialized with the following options:</p>
<ul>
<li>GuessValues: no explicit initial conditions
<li>InitialValues: initial values of temperature (or specific enthalpy), composition and level are specified
<li>SteadyStateHydraulic: initial values of temperature (or specific enthalpy) and composition are specified; the initial level is determined so that levels and pressure are at steady state.
</ul>
<p>
Full steady state initialization is not supported, because the corresponding intial equations for temperature/enthalpy are undetermined (the flow rate through the port at steady state is zero).
</p>
<pre></PRE><P>

<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>crossArea</TD><TD>&nbsp;</TD><TD>Tank area [m2]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>top_pipeArea[n_TopPorts]</TD><TD>&nbsp;</TD><TD>Area of outlet pipe [m2]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>side_pipeArea[n_SidePorts]</TD><TD>&nbsp;</TD><TD>Area of outlet pipe [m2]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>bottom_pipeArea[n_BottomPorts]</TD><TD>&nbsp;</TD><TD>Area of outlet pipe [m2]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>Height</A></TD><TD>height</TD><TD>10</TD><TD>Height of Tank [m]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V0</TD><TD>0</TD><TD>Volume of the liquid when the level is zero [m3]</TD></TR>
<TR><TD>Real</TD><TD>side_heights[n_SidePorts]</TD><TD>zeros(n_SidePorts)</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>bottom_heights[n_BottomPorts]</TD><TD>zeros(n_BottomPorts)</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>top_heights[n_TopPorts]</TD><TD>fill(height, n_TopPorts)</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_ambient</TD><TD>101325</TD><TD>Tank surface pressure [Pa]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_ambient</TD><TD>293.15</TD><TD>Tank surface Temperature [K]</TD></TR>
<TR><TD>Integer</TD><TD>n_TopPorts</TD><TD>1</TD><TD>number of Top connectors</TD></TR>
<TR><TD>Integer</TD><TD>n_SidePorts</TD><TD>1</TD><TD>number of side connectors</TD></TR>
<TR><TD>Integer</TD><TD>n_BottomPorts</TD><TD>1</TD><TD>number of bootom connectors</TD></TR>
<TR><TD>Real</TD><TD>min_level_for_heating</TD><TD>&nbsp;</TD><TD>&nbsp;</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>Height</A></TD><TD>level_start</TD><TD>&nbsp;</TD><TD>Initial tank level [m]</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init"
>Init</A></TD><TD>initType</TD><TD>Init.GuessValues</TD><TD>Initialization option</TD></TR>
<TR><TD>Boolean</TD><TD>use_T_start</TD><TD>true</TD><TD>Use T_start if true, otherwise h_start</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>if use_T_start then 293.15 e...</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.SpecificEnthalpy"
>SpecificEnthalpy</A></TD><TD>h_start</TD><TD>if use_T_start then Medium.s...</TD><TD>Start value of specific enthalpy [J/kg]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.reference_X</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>BottomFluidPort[n_BottomPorts]</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>TopFluidPort[n_TopPorts]</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>SideFluidPort[n_SidePorts]</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>FluidPort_b</A></TD><TD>Condensed</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heatPort</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> TankWith3InletOutletArraysWithEvaporatorCondensor <font color="darkgreen">
  &quot;Tank with Heating and Evaporation&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_SIunits_Conversions.html#Modelica.SIunits.Conversions"
>Modelica.SIunits.Conversions</A>.*;
  <font color="blue">import </font><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init</A>;
  <font color="blue">replaceable </font><font color="blue">package</font> Medium = <A HREF="Modelica_Media_Water_WaterIF97_ph.html#Modelica.Media.Water.WaterIF97_ph"
>Modelica.Media.Water.WaterIF97_ph</A>
    <font color="blue">constrainedby </font>Modelica.Media.Interfaces.PartialTwoPhaseMedium <font color="darkgreen">
    &quot;Medium in the component&quot;</font>;
<font color="darkgreen">// parameter for Tank</font>
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>Modelica.SIunits.Area</A> crossArea <font color="darkgreen">&quot;Tank area&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>SI.Area</A> top_pipeArea[n_TopPorts] <font color="darkgreen">&quot;Area of outlet pipe&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>SI.Area</A> side_pipeArea[n_SidePorts] <font color="darkgreen">&quot;Area of outlet pipe&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>SI.Area</A> bottom_pipeArea[n_BottomPorts] <font color="darkgreen">&quot;Area of outlet pipe&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>Modelica.SIunits.Height</A> height(min=0) = 10 <font color="darkgreen">&quot;Height of Tank&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>SI.Volume</A> V0=0 <font color="darkgreen">&quot;Volume of the liquid when the level is zero&quot;</font>;
  <font color="blue">constant </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</A> g=Modelica.Constants.g_n;
  <font color="blue">parameter </font>Real side_heights[n_SidePorts]=<font color="red">zeros</font>(n_SidePorts);
  <font color="blue">parameter </font>Real bottom_heights[n_BottomPorts]=<font color="red">zeros</font>(n_BottomPorts);
  <font color="blue">parameter </font>Real top_heights[n_TopPorts]=<font color="red">fill</font>(height, n_TopPorts);
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>SI.Height</A> level_start(min=0) <font color="darkgreen">&quot;Initial tank level&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Init</A>
    initType =                                 Init.GuessValues <font color="darkgreen">
    &quot;Initialization option&quot;</font>;
  <font color="blue">parameter </font>Boolean use_T_start=true <font color="darkgreen">&quot;Use T_start if true, otherwise h_start&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Medium.Temperature</A> T_start=<font color="blue">if </font>use_T_start<font color="blue"> then </font>293.15<font color="blue"> else </font>
      <font color="red">Medium.temperature_phX</font>(p_ambient, h_start, X_start) <font color="darkgreen">
    &quot;Start value of temperature&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.SpecificEnthalpy"
>Medium.SpecificEnthalpy</A> h_start=<font color="blue">if </font>use_T_start<font color="blue"> then </font><font color="red">Medium.specificEnthalpy_pTX</font>(
      p_ambient, T_start, X_start[1:Medium.nXi])<font color="blue"> else </font>1e4 <font color="darkgreen">
    &quot;Start value of specific enthalpy&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>Medium.MassFraction</A> X_start[Medium.nX]=Medium.reference_X <font color="darkgreen">
    &quot;Start value of mass fractions m_i/m&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>Medium.AbsolutePressure</A> p_ambient=101325 <font color="darkgreen">&quot;Tank surface pressure&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Medium.Temperature</A> T_ambient=293.15 <font color="darkgreen">&quot;Tank surface Temperature&quot;</font>;
  <font color="blue">parameter </font>Integer n_TopPorts=1 <font color="darkgreen">&quot;number of Top connectors&quot;</font>;
  <font color="blue">parameter </font>Integer n_SidePorts=1 <font color="darkgreen">&quot;number of side connectors&quot;</font>;
  <font color="blue">parameter </font>Integer n_BottomPorts=1 <font color="darkgreen">&quot;number of bootom connectors&quot;</font>;
  <A HREF="Modelica_Media_Water_WaterIF97_base.html#Modelica.Media.Water.WaterIF97_base.BaseProperties"
>Medium.BaseProperties</A> medium(
    preferredMediumStates=true,
    p(start=p_ambient),
    T(start=T_start),
    Xi(start=X_start[1:Medium.nXi]));
  <A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>Modelica.SIunits.Height</A> level(
    stateSelect=StateSelect.prefer,
    min=0,
    max=height) <font color="darkgreen">&quot;Level height of tank&quot;</font>;
  <A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>SI.Volume</A> V(stateSelect=StateSelect.never) <font color="darkgreen">&quot;Actual tank volume&quot;</font>;
  <A HREF="Modelica_SIunits.html#Modelica.SIunits.Energy"
>SI.Energy</A> U <font color="darkgreen">&quot;Internal energy of tank volume&quot;</font>;
  Real m(quantity=Medium.mediumName, unit=&quot;kg&quot;) <font color="darkgreen">&quot;Mass of tank volume&quot;</font>;
  Real mXi[Medium.nXi](quantity=Medium.substanceNames, <font color="blue">each </font>unit=&quot;kg&quot;) <font color="darkgreen">
    &quot;Component masses of the independent substances&quot;</font>;
<font color="darkgreen">// additional variables</font>
  Real H_flow_BottomPorts[n_BottomPorts];
  Real H_flow_SidePorts[n_SidePorts];
  Real H_flow_TopPorts[n_TopPorts];
  Real m_flow_BottomPorts[n_BottomPorts];
  Real m_flow_SidePorts[n_SidePorts];
  Real m_flow_TopPorts[n_TopPorts];

  Real m_flow_BottomPorts_pos[n_BottomPorts];
  Real m_flow_SidePorts_pos[n_SidePorts];
  Real m_flow_TopPorts_pos[n_TopPorts];
  Real m_flow_pos;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> mXi_flow_topPorts[n_TopPorts,Medium.nXi];
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> mXi_flowBottomPorts[n_BottomPorts,Medium.nXi];
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> mXi_flow_sidePorts[n_SidePorts,Medium.nXi];

<font color="darkgreen">// Connectors and InnerTanks</font>
<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>Modelica.Fluid.Interfaces.FluidPort_b</A> BottomFluidPort[n_BottomPorts](
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
    m_flow(<font color="blue">each </font>start=0));
  <A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>Modelica.Fluid.Interfaces.FluidPort_a</A> TopFluidPort[n_TopPorts](
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
    m_flow(<font color="blue">each </font>start=0));
  <A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>Modelica.Fluid.Interfaces.FluidPort_b</A> SideFluidPort[n_SidePorts](
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium,
    m_flow(<font color="blue">each </font>start=0));
  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank</A> InnerTankTop[n_TopPorts](
    <font color="blue">each </font>h=medium.h,
    <font color="blue">each </font>p_ambient=p_ambient,
    <font color="blue">each </font>d=medium.d,
    <font color="blue">each </font>Xi = medium.Xi,
    aboveLevel={level - top_heights[i] <font color="blue">for </font>i<font color="blue"> in </font>1:n_TopPorts},
    pipeArea={top_pipeArea[i] <font color="blue">for </font>i<font color="blue"> in </font>1:n_TopPorts},
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium);
  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank</A>
    InnerTankSide[                                                           n_SidePorts](
    <font color="blue">each </font>h=medium.h,
    <font color="blue">each </font>p_ambient=p_ambient,
    <font color="blue">each </font>d=medium.d,
    <font color="blue">each </font>Xi = medium.Xi,
    aboveLevel={level - side_heights[i] <font color="blue">for </font>i<font color="blue"> in </font>1:n_SidePorts},
    pipeArea={side_pipeArea[i] <font color="blue">for </font>i<font color="blue"> in </font>1:n_SidePorts},
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium);
  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank</A>
    InnerTankBottom[                                                           n_BottomPorts](
    <font color="blue">each </font>h=medium.h,
    <font color="blue">each </font>p_ambient=p_ambient,
    <font color="blue">each </font>d=medium.d,
    <font color="blue">each </font>Xi = medium.Xi,
    aboveLevel={level - bottom_heights[i] <font color="blue">for </font>i<font color="blue"> in </font>1:n_BottomPorts},
    pipeArea={bottom_pipeArea[i] <font color="blue">for </font>i<font color="blue"> in </font>1:n_BottomPorts},
    <font color="blue">redeclare </font><font color="blue">package</font> Medium = Medium);
  <A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_b"
>Modelica.Fluid.Interfaces.FluidPort_b</A> Condensed(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
               Medium);</textblock>

  <font color="darkgreen">// Heat transfer through boundary</font>
  <font color="blue">replaceable </font><font color="blue">model</font> HeatTransfer =
      <A HREF="Modelica_Fluid_Vessels_BaseClasses_HeatTransfer.html#Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer"
>Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer</A>
    <font color="blue">constrainedby </font>
    Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.PartialVesselHeatTransfer <font color="darkgreen">
    &quot;Wall heat transfer&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransfer"
>HeatTransfer</A> heatTransfer(
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">final </font>n=1,
    <font color="blue">final </font>states = {medium.state},
    surfaceAreas={crossArea+2*<font color="red">sqrt</font>(crossArea*Modelica.Constants.pi)*level},
    <font color="blue">final </font>use_k = true);
  <A HREF="Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A> heatPort;</textblock>

<font color="darkgreen">// parameter for Evaporator</font>
  <font color="blue">parameter </font>Real min_level_for_heating;

  <A HREF="Modelica_Media_Interfaces_PartialTwoPhaseMedium.html#Modelica.Media.Interfaces.PartialTwoPhaseMedium.SaturationProperties"
>Medium.SaturationProperties</A> sat <font color="darkgreen">
    &quot;State vector to compute saturation properties&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.SpecificEnthalpy"
>Medium.SpecificEnthalpy</A> h_v=<font color="red">Medium.dewEnthalpy</font>(sat) <font color="darkgreen">
    &quot;specific enthalpy of vapour&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.SpecificEnthalpy"
>Medium.SpecificEnthalpy</A> h_l=<font color="red">Medium.bubbleEnthalpy</font>(sat) <font color="darkgreen">
    &quot;specific enthalpy of liquid&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.SpecificEnthalpy"
>Medium.SpecificEnthalpy</A> h <font color="darkgreen">&quot;&#39;is&#39;specific enthalpy of liquid&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Density"
>Medium.Density</A> rho_v=<font color="red">Medium.dewDensity</font>(sat) <font color="darkgreen">&quot;density in vapour phase&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Density"
>Medium.Density</A> rho_l=<font color="red">Medium.bubbleDensity</font>(sat) <font color="darkgreen">&quot;density in liquid phase&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Density"
>Medium.Density</A> rho <font color="darkgreen">&quot;&#39;is&#39; density in liquid phase&quot;</font>;

<font color="blue">equation </font>
  H_flow_TopPorts   = InnerTankTop.H_flow;
  m_flow_TopPorts   = InnerTankTop.m_flow;
  mXi_flow_topPorts = InnerTankTop.mXi_flow;

  H_flow_SidePorts   = InnerTankSide.H_flow;
  m_flow_SidePorts   = InnerTankSide.m_flow;
  mXi_flow_sidePorts = InnerTankSide.mXi_flow;

  H_flow_BottomPorts  = InnerTankBottom.H_flow;
  m_flow_BottomPorts  = InnerTankBottom.m_flow;
  mXi_flowBottomPorts = InnerTankBottom.mXi_flow;

  <font color="blue">for </font>i<font color="blue"> in </font>1:n_BottomPorts<font color="blue"> loop</font>
    m_flow_BottomPorts_pos[i] = (<font color="blue">if </font>m_flow_BottomPorts[i] &gt; 0<font color="blue"> then </font>
      m_flow_BottomPorts[i]<font color="blue"> else </font>0);
  <font color="blue">end for</font>;
  <font color="blue">for </font>i<font color="blue"> in </font>1:n_SidePorts<font color="blue"> loop</font>
    m_flow_SidePorts_pos[i] = <font color="blue">if </font>m_flow_SidePorts[i] &gt; 0<font color="blue"> then </font>m_flow_SidePorts[
      i]<font color="blue"> else </font>0;
  <font color="blue">end for</font>;
  <font color="blue">for </font>i<font color="blue"> in </font>1:n_TopPorts<font color="blue"> loop</font>
    m_flow_TopPorts_pos[i] = <font color="blue">if </font>m_flow_TopPorts[i] &gt; 0<font color="blue"> then </font>m_flow_TopPorts[i]<font color="blue"> else </font>
            0;
  <font color="blue">end for</font>;
  <font color="blue">for </font>i<font color="blue"> in </font>1:n_BottomPorts<font color="blue"> loop</font>
<textblock type="annotconnect" expanded="false">    <font color="red">connect</font>(InnerTankBottom[i].port, BottomFluidPort[i]);</textblock>
  <font color="blue">end for</font>;
  <font color="blue">for </font>i<font color="blue"> in </font>1:n_TopPorts<font color="blue"> loop</font>
<textblock type="annotconnect" expanded="false">    <font color="red">connect</font>(InnerTankTop[i].port, TopFluidPort[i]);</textblock>
  <font color="blue">end for</font>;
  <font color="blue">for </font>i<font color="blue"> in </font>1:n_SidePorts<font color="blue"> loop</font>
<textblock type="annotconnect" expanded="false">    <font color="red">connect</font>(InnerTankSide[i].port, SideFluidPort[i]);</textblock>
  <font color="blue">end for</font>;

  medium.p = p_ambient;
<font color="darkgreen">// Mass balance</font>
  <font color="red">der</font>(m) =<font color="red"> sum</font>(m_flow_BottomPorts) +<font color="red"> sum</font>(m_flow_SidePorts) +<font color="red"> sum</font>(
    m_flow_TopPorts) + Condensed.m_flow;
<font color="darkgreen">// Energy balance</font>

  U = m*medium.h - p_ambient*V <font color="darkgreen">&quot;Internal energy of fluid&quot;</font>;
  m = V*medium.d <font color="darkgreen">&quot;Mass of fluid&quot;</font>;
  V = crossArea*level + V0 <font color="darkgreen">&quot;Volume of fluid&quot;</font>;
  mXi = m*medium.Xi <font color="darkgreen">&quot;Mass of fluid components&quot;</font>;
  sat.psat = medium.p;
  sat.Tsat =<font color="red"> Medium.saturationTemperature</font>(medium.p);

  <font color="blue">if </font><font color="red">noEvent</font>(medium.T &lt; sat.Tsat)<font color="blue"> then</font>
    <font color="blue">if </font>Medium.singleState<font color="blue"> then</font>
      <font color="red">der</font>(U) =<font color="red"> sum</font>(H_flow_BottomPorts) +<font color="red"> sum</font>(H_flow_SidePorts) +<font color="red"> sum</font>(
        H_flow_TopPorts) + Condensed.m_flow*<font color="red">actualStream</font>(Condensed.h_outflow) + heatTransfer.Q_flows[1] <font color="darkgreen">
        &quot;Mechanical work is neglected&quot;</font>;
    <font color="blue">else</font>
      <font color="red">der</font>(U) =<font color="red"> sum</font>(H_flow_BottomPorts) +<font color="red"> sum</font>(H_flow_SidePorts) +<font color="red"> sum</font>(
        H_flow_TopPorts) + Condensed.m_flow*<font color="red">actualStream</font>(Condensed.h_outflow) - p_ambient*<font color="red">der</font>(V) +
        heatTransfer.Q_flows[1];
    <font color="blue">end if</font>;
    Condensed.h_outflow = h;
    Condensed.m_flow = 0;
    rho = medium.d;
    h = medium.h;
  <font color="blue">else</font>
    <font color="blue">if </font>Medium.singleState<font color="blue"> then</font>
      <font color="red">der</font>(U) =<font color="red"> sum</font>(H_flow_BottomPorts) +<font color="red"> sum</font>(H_flow_SidePorts) +<font color="red"> sum</font>(H_flow_TopPorts)
         + Condensed.m_flow*<font color="red">actualStream</font>(Condensed.h_outflow) <font color="darkgreen">
        &quot;Mechanical work is neglected&quot;</font>;
    <font color="blue">else</font>
      <font color="red">der</font>(U) =<font color="red"> sum</font>(H_flow_BottomPorts) +<font color="red"> sum</font>(H_flow_SidePorts) +<font color="red"> sum</font>(
        H_flow_TopPorts) + Condensed.m_flow*<font color="red">actualStream</font>(Condensed.h_outflow) - p_ambient*<font color="red">der</font>(V);
    <font color="blue">end if</font>;
    Condensed.h_outflow = h;
    Condensed.m_flow = -heatTransfer.Q_flows[1]/(h_v - h_l);
    rho = rho_l;<font color="darkgreen">//Density = liquid Densety</font>
    h = h_l;<font color="darkgreen">    //Enthalpy = liquid Enthalpy</font>
    <font color="blue">if </font><font color="red">noEvent</font>(heatPort.Q_flow &gt; 0.0)<font color="blue"> then</font>
      <font color="red">assert</font>(<font color="red">noEvent</font>(<font color="red">abs</font>(m_flow_pos) &lt;= 0.01), &quot;Attempt to fill tank while evaporating.&quot;);
    <font color="blue">end if</font>;

  <font color="blue">end if</font>;

  m_flow_pos =<font color="red"> sum</font>(m_flow_TopPorts_pos) +<font color="red"> sum</font>(m_flow_SidePorts_pos) +<font color="red"> sum</font>(
    m_flow_BottomPorts_pos);

  <font color="blue">for </font>i<font color="blue"> in </font>1:Medium.nXi<font color="blue"> loop</font>
    <font color="red">   der</font>(mXi[i]) =<font color="red"> sum</font>(mXi_flowBottomPorts[:,i]) +
                     <font color="red">sum</font>(mXi_flow_sidePorts[:,i]) +
                     <font color="red">sum</font>(mXi_flow_topPorts[:,i]);
  <font color="blue">end for</font>;

  <font color="red">assert</font>(level &lt; height, &quot;
    Tank is overflowing.
    &quot;);

  <font color="red">assert</font>(<font color="blue">not </font>(heatPort.Q_flow &gt; 0.0<font color="blue"> and </font>level &lt;= min_level_for_heating), &quot;
    Attempting to heat an empty tank
  &quot;);

<font color="blue">initial </font><font color="blue">equation </font>
  <font color="blue">if </font>initType == Init.GuessValues<font color="blue"> then</font>
    <font color="darkgreen">// no initial equations</font>
  <font color="blue">elseif </font>initType == Init.InitialValues<font color="blue"> then</font>
    level = level_start;
    <font color="blue">if </font>use_T_start<font color="blue"> then</font>
      medium.T = T_start;
    <font color="blue">else</font>
      medium.h = h_start;
    <font color="blue">end if</font>;
    medium.Xi = X_start[1:Medium.nXi];
  <font color="blue">elseif </font>initType == Init.SteadyStateHydraulic<font color="blue"> then</font>
    <font color="red">der</font>(level) = 0;
    <font color="blue">if </font>use_T_start<font color="blue"> then</font>
      medium.T = T_start;
    <font color="blue">else</font>
      medium.h = h_start;
    <font color="blue">end if</font>;
    medium.Xi = X_start[1:Medium.nXi];
  <font color="blue">else</font>
    <font color="red">assert</font>(false, &quot;Unsupported initialization option&quot;);
  <font color="blue">end if</font>;


<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(heatPort, heatTransfer.heatPorts[1]);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>TankWith3InletOutletArraysWithEvaporatorCondensor;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE InnerTank<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTankI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</A>.InnerTank</H2>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTankD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.InnerTank">
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>Xi[Medium.nXi]</TD><TD>&nbsp;</TD><TD>Actual mass fractions of fluid in tank [kg/kg]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>FluidPort_a</A></TD><TD>port</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> InnerTank
    <font color="blue">replaceable </font><font color="blue">package</font> Medium =
    <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>Modelica.Media.Interfaces.PartialMedium</A> <font color="darkgreen">&quot;Medium in the component&quot;</font>;

<textblock type="annotcomp" expanded="false">    <A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.FluidPort_a"
>Modelica.Fluid.Interfaces.FluidPort_a</A> port(<font color="blue">redeclare </font><font color="blue">package</font> Medium =
        Medium);</textblock>
    Boolean m_flow_negative( start = true) <font color="darkgreen">&quot;true= massflow out of tank&quot;</font>;
    <font color="blue">constant </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Acceleration"
>Modelica.SIunits.Acceleration</A> g=Modelica.Constants.g_n;
    <font color="blue">input </font>Real aboveLevel;
    <font color="blue">input </font>Real d;
    <font color="blue">input </font>Real p_ambient;
    <font color="blue">input </font>Real h;
    <font color="blue">input </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>Medium.MassFraction</A> Xi[Medium.nXi] <font color="darkgreen">
    &quot;Actual mass fractions of fluid in tank&quot;</font>;
    <font color="blue">input </font>Real pipeArea;
    <font color="blue">output </font>Real H_flow;
    <font color="blue">output </font>Real m_flow;
   <font color="blue">output </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> mXi_flow[Medium.nXi] <font color="darkgreen">
    &quot;= port.mXi_flow (used to transform vector of connectors in vector of Real numbers)&quot;</font>;

<font color="blue">equation </font>
m_flow_negative = (<font color="red">pre</font>(m_flow_negative)<font color="blue"> and </font><font color="blue">not </font>port.p&gt;p_ambient)<font color="blue"> or </font>(port.m_flow &lt; -1e-6);

<font color="blue">if </font><font color="red">noEvent</font>(aboveLevel &gt; 0)<font color="blue"> then</font>
  port.p = aboveLevel*g*d + p_ambient -<font color="red"> smooth</font>(2,<font color="red">noEvent</font>(<font color="blue">if </font><font color="red">noEvent</font>(m_flow &lt; 0)<font color="blue"> then </font>m_flow^2/(2*d*pipeArea^2)<font color="blue"> else </font>0));
<font color="blue">else</font>
 <font color="blue">if </font><font color="red">pre</font>(m_flow_negative)<font color="blue"> then</font>
    port.m_flow = 0;
  <font color="blue">else</font>
    port.p = p_ambient;
  <font color="blue">end if</font>;
<font color="blue">end if</font>;

  H_flow = port.m_flow*<font color="red">actualStream</font>(port.h_outflow);
  m_flow = port.m_flow;
  mXi_flow = port.m_flow*<font color="red">actualStream</font>(port.Xi_outflow);
  port.h_outflow = h;
  port.Xi_outflow = Xi;
<font color="blue">end </font>InnerTank;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Controller<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Controller" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Controller"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</A>.Controller</H2>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.Controller">
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>Real</TD><TD>w_dilution</TD><TD>0.003</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>w_concentrate</TD><TD>0.005</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>startTime</TD><TD>1</TD><TD>&nbsp;</TD></TR>
<TR><TD>Real</TD><TD>T5_batch_level</TD><TD>0.211</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses_ControllerUtilities.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities.Port_Sensors"
>Port_Sensors</A></TD><TD>sensors</TD><TD>&nbsp;</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses_ControllerUtilities.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities.Port_Actuators"
>Port_Actuators</A></TD><TD>actuators</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> Controller

<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses_ControllerUtilities.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities.Port_Sensors"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities.Port_Sensors</A>
    sensors;
  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses_ControllerUtilities.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities.Port_Actuators"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.ControllerUtilities.Port_Actuators</A>
    actuators;</textblock>

  <font color="blue">parameter </font>Real w_dilution=0.003;
  <font color="blue">parameter </font>Real w_concentrate=0.005;
  <font color="blue">parameter </font>Real startTime=1;
  <font color="blue">parameter </font>Real T5_batch_level=0.211;

<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.InitialStep"
>Modelica.StateGraph.InitialStep</A> InitialStep1;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition1(enableTimer=true, waitTime=
        startTime);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step1;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition2(condition=LIS_301 &gt;= 0.13);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step2;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition3(
    condition=true,
    enableTimer=true,
    waitTime=500);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step3;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition4(condition=LIS_301 &lt;= 0.01);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step4;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition5(condition=T5_idle);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step5;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition6(condition=LIS_501 &gt;=
        T5_batch_level);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step6;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition7(
    condition=true,
    enableTimer=true,
    waitTime=300);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Parallel"
>Modelica.StateGraph.Parallel</A> Parallel1;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step7;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step8;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step9;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step10;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step11;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step12;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step13;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Step"
>Modelica.StateGraph.Step</A> Step14;
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition8(condition=T7_idle);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition9(condition=LIS_501 &lt;= 0.01);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition10(condition=TIS_702 &lt;= 298);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition11(condition=LIS_701 &lt;= 0.01);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition12(condition=TIS_602 &lt;= 298);
  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.Transition"
>Modelica.StateGraph.Transition</A> Transition13(condition=LIS_601 &lt;= 0.01);</textblock>

  Real LIS_301;
  Real LIS_501;
  Real LIS_601;
  Real LIS_701;
  Real QI_302;
  Real QIS_502;
  Real TIS_602;
  Real TIS_702;
  Boolean T5_idle;
  Boolean T7_idle;
<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_StateGraph.html#Modelica.StateGraph.TransitionWithSignal"
>Modelica.StateGraph.TransitionWithSignal</A> TransitionWithSignal1;
  <A HREF="Modelica_Blocks_Sources.html#Modelica.Blocks.Sources.BooleanExpression"
>Modelica.Blocks.Sources.BooleanExpression</A> BooleanExpression1(y=time &gt;
        2500);</textblock>
<font color="blue">equation </font>
  LIS_301 = sensors.LIS_301;
  LIS_501 = sensors.LIS_501;
  LIS_601 = sensors.LIS_601;
  LIS_701 = sensors.LIS_701;
  QI_302 = sensors.QI_302;
  QIS_502 = sensors.QIS_502;
  TIS_602 = sensors.TIS_602;
  TIS_702 = sensors.TIS_702;
  T5_idle = <font color="blue">not </font>actuators.V12<font color="blue"> and </font><font color="blue">not </font>actuators.V15<font color="blue"> and </font><font color="blue">not </font>actuators.T5_Heater<font color="blue">
     and </font>sensors.LIS_501 &lt; 0.01;
  T7_idle = <font color="blue">not </font>actuators.V15<font color="blue"> and </font><font color="blue">not </font>actuators.V18<font color="blue"> and </font><font color="blue">not </font>actuators.
    T7_Cooling<font color="blue"> and </font>sensors.LIS_701 &lt; 0.01;

  actuators.P1 = Step10.active;
  actuators.P2 = Step13.active;
  actuators.T5_Heater = Step6.active;
  actuators.T7_Cooling = Step9.active;
  actuators.T6_Cooling = Step12.active;
  actuators.V1 = Step10.active;
  actuators.V2 = false;
  actuators.V3 = Step10.active;
  actuators.V4 = false;
  actuators.V5 = Step13.active;
  actuators.V6 = Step13.active;
  actuators.V8 = Step1.active;
  actuators.V9 = Step2.active;
  actuators.V10 = false;
  actuators.V11 = Step3.active;
  actuators.V12 = Step5.active;
  actuators.V15 = Step8.active;
  actuators.V18 = Step10.active;
  actuators.V19 = false;
  actuators.V20 = Step13.active;
  actuators.V21 = false;
  actuators.V22 = Step10.active;
  actuators.V23 = Step10.active;
  actuators.V25 = Step13.active;
  actuators.V24 = Step13.active;

<textblock type="annotconnect" expanded="false">  <font color="red">connect</font>(InitialStep1.outPort[1], Transition1.inPort);
  <font color="red">connect</font>(Transition1.outPort, Step1.inPort[1]);
  <font color="red">connect</font>(Step1.outPort[1], Transition2.inPort);
  <font color="red">connect</font>(Transition2.outPort, Step2.inPort[1]);
  <font color="red">connect</font>(Step2.outPort[1], Transition3.inPort);
  <font color="red">connect</font>(Transition3.outPort, Step3.inPort[1]);
  <font color="red">connect</font>(Step3.outPort[1], Transition4.inPort);
  <font color="red">connect</font>(Transition4.outPort, Step4.inPort[1]);
  <font color="red">connect</font>(Step4.outPort[1], Transition5.inPort);
  <font color="red">connect</font>(Transition5.outPort, Step5.inPort[1]);
  <font color="red">connect</font>(Step5.outPort[1], Transition6.inPort);
  <font color="red">connect</font>(Transition6.outPort, Step6.inPort[1]);
  <font color="red">connect</font>(Step6.outPort[1], Transition7.inPort);
  <font color="red">connect</font>(Step12.inPort[1], Parallel1.split[1]);
  <font color="red">connect</font>(Step12.outPort[1], Transition12.inPort);
  <font color="red">connect</font>(Transition12.outPort, Step13.inPort[1]);
  <font color="red">connect</font>(Step13.outPort[1], Transition13.inPort);
  <font color="red">connect</font>(Transition13.outPort, Step14.inPort[1]);
  <font color="red">connect</font>(Step14.outPort[1], Parallel1.join[1]);
  <font color="red">connect</font>(Step7.inPort[1], Parallel1.split[2]);
  <font color="red">connect</font>(Step7.outPort[1], Transition8.inPort);
  <font color="red">connect</font>(Transition8.outPort, Step8.inPort[1]);
  <font color="red">connect</font>(Step8.outPort[1], Transition9.inPort);
  <font color="red">connect</font>(Transition9.outPort, Step9.inPort[1]);
  <font color="red">connect</font>(Step9.outPort[1], Transition10.inPort);
  <font color="red">connect</font>(Transition10.outPort, Step10.inPort[1]);
  <font color="red">connect</font>(Step10.outPort[1], Transition11.inPort);
  <font color="red">connect</font>(Transition11.outPort, Step11.inPort[1]);
  <font color="red">connect</font>(Step11.outPort[1], Parallel1.join[2]);
  <font color="red">connect</font>(Transition7.outPort, Parallel1.inPort);
  <font color="red">connect</font>(TransitionWithSignal1.inPort, Parallel1.outPort);
  <font color="red">connect</font>(TransitionWithSignal1.outPort, InitialStep1.inPort[1]);
  <font color="red">connect</font>(BooleanExpression1.y, TransitionWithSignal1.condition);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>Controller;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE TankWithTopPorts<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPortsI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses</A>.TankWithTopPorts</H2>
<B>Tank with inlet/outlet ports and with inlet ports at the top</B><p>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPortsD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts">
<P><H3>Information</H3></P>
<PRE></pre>
<p>
Model of a tank that is open to the environment at the fixed pressure
<code>p_ambient</code>.
The tank is filled with a single or multiple-substance liquid,
assumed to have uniform temperature and mass fractions.
</p>

<p>
At the top of the tank over the maximal fill level <b>height</b>
a vector of FluidPorts, called <b>topPorts</b>, is present.
The assumption is made that fluid flows always in to the tank via these
ports (and never back in to the connector).
</p>

<p>
The vector of connectors <b>ports</b> are fluid ports at the bottom
and side of the tank at a defineable height. Fluid can flow either out
of or in to this port. The fluid level of the tank may be below
one of these ports. This case is approximated by introducing a
large pressure flow coefficient so that the mass flow rate
through this port is very small in this case.
</p>

<p>
If the tank starts to over flow (i.e., level > height), an
assertion is triggered.
</p>

<p>
When the diagram layer is open in the plot environment, the
level of the tank is dynamically visualized. Note, the speed
of the diagram animation in Dymola can be set via command
<b>animationSpeed</b>(), e.g., animationSpeed(speed = 10)
</p>
<pre></PRE><P>
Extends from <A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.PartialLumpedVolume"
>Modelica.Fluid.Interfaces.PartialLumpedVolume</A> (Lumped volume with mass and energy balance).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>Height</A></TD><TD>height</TD><TD>&nbsp;</TD><TD>Maximum level of tank before it overflows [m]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>Area</A></TD><TD>crossArea</TD><TD>&nbsp;</TD><TD>Area of tank [m2]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>V0</TD><TD>0</TD><TD>Volume of the liquid when level = 0 [m3]</TD></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>Volume</A></TD><TD>fluidVolume</TD><TD>V</TD><TD>Volume [m3]</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselPortsData"
>VesselPortsData</A></TD><TD>portsData[nPorts]</TD><TD>&nbsp;</TD><TD>Data of inlet/outlet ports at side and bottom of tank</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Assumptions</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Ambient</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_ambient</TD><TD>system.p_ambient</TD><TD>Tank surface pressure [Pa]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_ambient</TD><TD>system.T_ambient</TD><TD>Tank surface Temperature [K]</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Dynamics</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>energyDynamics</TD><TD>system.energyDynamics</TD><TD>Formulation of energy balance</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Types.html#Modelica.Fluid.Types.Dynamics"
>Dynamics</A></TD><TD>massDynamics</TD><TD>system.massDynamics</TD><TD>Formulation of mass balance</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Heat transfer</TD></TR>
<TR><TD>Boolean</TD><TD>use_HeatTransfer</TD><TD>false</TD><TD>= true to use the HeatTransfer model</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Initialization</B></TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>Height</A></TD><TD>level_start</TD><TD>0.5*height</TD><TD>Start value of tank level [m]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>AbsolutePressure</A></TD><TD>p_start</TD><TD>p_ambient</TD><TD>Start value of pressure [Pa]</TD></TR>
<TR><TD>Boolean</TD><TD>use_T_start</TD><TD>true</TD><TD>= true, use T_start, otherwise h_start</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Temperature</A></TD><TD>T_start</TD><TD>if use_T_start then system.T...</TD><TD>Start value of temperature [K]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.SpecificEnthalpy"
>SpecificEnthalpy</A></TD><TD>h_start</TD><TD>if use_T_start then Medium.s...</TD><TD>Start value of specific enthalpy [J/kg]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFraction"
>MassFraction</A></TD><TD>X_start[Medium.nX]</TD><TD>Medium.X_default</TD><TD>Start value of mass fractions m_i/m [kg/kg]</TD></TR>
<TR><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.ExtraProperty"
>ExtraProperty</A></TD><TD>C_start[Medium.nC]</TD><TD>fill(0, Medium.nC)</TD><TD>Start value of trace substances</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Advanced</B></TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Port properties</TD></TR>
<TR><TD>Real</TD><TD>hysteresisFactor</TD><TD>0.1</TD><TD>Hysteresis for empty pipe = diameter*hysteresisFactor</TD></TR>
<TR><TD>Boolean</TD><TD>stiffCharacteristicForEmptyPort</TD><TD>false</TD><TD>=true, if steep pressure loss characteristic for empty pipe port</TD></TR>
<TR><TD>Real</TD><TD>zetaLarge</TD><TD>1e5</TD><TD>Large pressure loss factor if mass flows out of empty pipe port</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>MassFlowRate</A></TD><TD>m_flow_small</TD><TD>system.m_flow_small</TD><TD>Regularization range at zero mass flow rate [kg/s]</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselFluidPorts_a"
>VesselFluidPorts_a</A></TD><TD>topPorts[nTopPorts]</TD><TD>Inlet ports over height at top of tank (fluid flows only from the port in to the tank)</TD></TR>
<TR><TD><A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselFluidPorts_b"
>VesselFluidPorts_b</A></TD><TD>ports[nPorts]</TD><TD>inlet/outlet ports at bottom or side of tank (fluid flows in to or out of port; a port might be above the fluid level)</TD></TR>
<TR><TD><A HREF="Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>HeatPort_a</A></TD><TD>heatPort</TD><TD>&nbsp;</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> TankWithTopPorts <font color="darkgreen">
  &quot;Tank with inlet/outlet ports and with inlet ports at the top&quot;</font>

    <font color="blue">import </font><A HREF="Modelica_Constants.html#Modelica.Constants"
>Modelica.Constants</A>;
    <font color="blue">import </font><A HREF="Modelica_Fluid_Fittings_BaseClasses.html#Modelica.Fluid.Fittings.BaseClasses.lossConstant_D_zeta"
>Modelica.Fluid.Fittings.BaseClasses.lossConstant_D_zeta</A>;
    <font color="blue">import </font><A HREF="Modelica_Fluid_Utilities.html#Modelica.Fluid.Utilities.regRoot2"
>Modelica.Fluid.Utilities.regRoot2</A>;
    <font color="blue">import </font><A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselPortsData"
>Modelica.Fluid.Vessels.BaseClasses.VesselPortsData</A>;

  <A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>SI.Height</A> level(stateSelect=StateSelect.prefer, start=level_start) <font color="darkgreen">
    &quot;Fluid level in the tank&quot;</font>;

  <font color="darkgreen">//Tank geometry</font>
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>SI.Height</A> height <font color="darkgreen">&quot;Maximum level of tank before it overflows&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>SI.Area</A> crossArea <font color="darkgreen">&quot;Area of tank&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>SI.Volume</A> V0=0 <font color="darkgreen">&quot;Volume of the liquid when level = 0&quot;</font>;

  <font color="darkgreen">//Ambient</font>
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.AbsolutePressure"
>Medium.AbsolutePressure</A> p_ambient=system.p_ambient <font color="darkgreen">
    &quot;Tank surface pressure&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.Temperature"
>Medium.Temperature</A> T_ambient=system.T_ambient <font color="darkgreen">
    &quot;Tank surface Temperature&quot;</font>;

  <font color="darkgreen">//Initialization</font>
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Height"
>SI.Height</A> level_start(min=0) = 0.5*height <font color="darkgreen">
    &quot;Start value of tank level&quot;</font>;

  <font color="darkgreen">//Mass and energy balance</font>
  <font color="blue">extends </font><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.PartialLumpedVolume"
>Modelica.Fluid.Interfaces.PartialLumpedVolume</A>(
    <font color="blue">final </font>fluidVolume = V,
    <font color="blue">final </font>initialize_p = false,
    <font color="blue">final </font>p_start = p_ambient);

  <font color="darkgreen">//Port definitions</font>
  <font color="blue">parameter </font>Integer nTopPorts = 0 <font color="darkgreen">&quot;Number of inlet ports above height (&gt;= 1)&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselFluidPorts_a"
>Vessels.BaseClasses.VesselFluidPorts_a</A> topPorts[nTopPorts](<font color="blue">redeclare </font><font color="blue">package</font>
      Medium =           Medium, m_flow(<font color="blue">each </font>start=0, <font color="blue">each </font>min=0)) <font color="darkgreen">
    &quot;Inlet ports over height at top of tank (fluid flows only from the port in to the tank)&quot;</font>;
    </textblock>

  <font color="blue">parameter </font>Integer nPorts = 0 <font color="darkgreen">
    &quot;Number of inlet/outlet ports (on bottom and on the side)&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselPortsData"
>Modelica.Fluid.Vessels.BaseClasses.VesselPortsData</A> portsData[
                                                                      nPorts] <font color="darkgreen">
    &quot;Data of inlet/outlet ports at side and bottom of tank&quot;</font>;

<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Fluid_Vessels_BaseClasses.html#Modelica.Fluid.Vessels.BaseClasses.VesselFluidPorts_b"
>Vessels.BaseClasses.VesselFluidPorts_b</A> ports[nPorts](<font color="blue">redeclare </font><font color="blue">package</font> Medium
      =          Medium, m_flow(<font color="blue">each </font>start=0)) <font color="darkgreen">
    &quot;inlet/outlet ports at bottom or side of tank (fluid flows in to or out of port; a port might be above the fluid level)&quot;</font>;
    </textblock>

  <font color="darkgreen">// Heat transfer through boundary</font>
  <font color="blue">parameter </font>Boolean use_HeatTransfer = false <font color="darkgreen">
    &quot;= true to use the HeatTransfer model&quot;</font>;
  <font color="blue">replaceable </font><font color="blue">model</font> HeatTransfer =
      <A HREF="Modelica_Fluid_Vessels_BaseClasses_HeatTransfer.html#Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer"
>Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer</A>
    <font color="blue">constrainedby </font>
    Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.PartialVesselHeatTransfer <font color="darkgreen">
    &quot;Wall heat transfer&quot;</font>;
<textblock type="annotcomp" expanded="false">  <A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts.HeatTransfer"
>HeatTransfer</A> heatTransfer(
    <font color="blue">redeclare </font><font color="blue">final </font><font color="blue">package</font> Medium = Medium,
    <font color="blue">final </font>n=1,
    <font color="blue">final </font>states = {medium.state},
    surfaceAreas={crossArea+2*<font color="red">sqrt</font>(crossArea*Modelica.Constants.pi)*level},
    <font color="blue">final </font>use_k = use_HeatTransfer);
  <A HREF="Modelica_Thermal_HeatTransfer_Interfaces.html#Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a"
>Modelica.Thermal.HeatTransfer.Interfaces.HeatPort_a</A> heatPort <font color="blue">if </font>use_HeatTransfer;</textblock>

  <font color="darkgreen">// Advanced</font>
  <font color="blue">parameter </font>Real hysteresisFactor(min=0) = 0.1 <font color="darkgreen">
    &quot;Hysteresis for empty pipe = diameter*hysteresisFactor&quot;</font>;
  <font color="blue">parameter </font>Boolean stiffCharacteristicForEmptyPort = false <font color="darkgreen">
    &quot;=true, if steep pressure loss characteristic for empty pipe port&quot;</font>;
  <font color="blue">parameter </font>Real zetaLarge(min=0) = 1e5 <font color="darkgreen">
    &quot;Large pressure loss factor if mass flows out of empty pipe port&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate"
>SI.MassFlowRate</A> m_flow_small(min=0) = system.m_flow_small <font color="darkgreen">
    &quot;Regularization range at zero mass flow rate&quot;</font>;

  <font color="darkgreen">// Tank properties</font>
  <A HREF="Modelica_SIunits.html#Modelica.SIunits.Volume"
>SI.Volume</A> V(stateSelect=StateSelect.never) <font color="darkgreen">&quot;Actual tank volume&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.EnthalpyFlowRate"
>Medium.EnthalpyFlowRate</A> H_flow_top[nTopPorts] <font color="darkgreen">
    &quot;Enthalpy flow rates from the top ports in to the tank&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.EnthalpyFlowRate"
>Medium.EnthalpyFlowRate</A> port_b_H_flow_bottom[nPorts] <font color="darkgreen">
    &quot;Enthalpy flow rates from the bottom ports in to the tank&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> mXi_flow_top[nTopPorts, Medium.nXi] <font color="darkgreen">
    &quot;Substance mass flow rates from the top ports into the tank&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> port_b_mXi_flow_bottom[nPorts, Medium.nXi] <font color="darkgreen">
    &quot;Substance mass flow rates from the bottom ports into the tank&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> mC_flow_top[nTopPorts, Medium.nC] <font color="darkgreen">
    &quot;Trace substance mass flow rates from the top ports into the tank&quot;</font>;
  <A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium.MassFlowRate"
>Medium.MassFlowRate</A> port_b_mC_flow_bottom[nPorts, Medium.nC] <font color="darkgreen">
    &quot;Trace substance mass flow rates from the bottom ports into the tank&quot;</font>;
<font color="blue">protected </font>
    <A HREF="Modelica_SIunits.html#Modelica.SIunits.Area"
>SI.Area</A> bottomArea[nPorts];
    <A HREF="Modelica_SIunits.html#Modelica.SIunits.Diameter"
>SI.Diameter</A> ports_emptyPipeHysteresis[nPorts];
    <A HREF="Modelica_SIunits.html#Modelica.SIunits.Length"
>SI.Length</A> levelAbovePort[nPorts] <font color="darkgreen">&quot;Height of fluid over bottom ports&quot;</font>;
    Boolean ports_m_flow_out[nPorts](<font color="blue">each </font>start = true, <font color="blue">each </font>fixed=true);
    Boolean aboveLevel[nPorts] <font color="darkgreen">&quot;= true, if level &gt;= ports[i].height&quot;</font>;
    Real zetas_out[nPorts];
    <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> portsData_diameter[nPorts] = portsData.diameter <font color="blue">if </font>nPorts &gt; 0;
    <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> portsData_diameter2[nPorts];
    <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> portsData_height[nPorts] = portsData.height <font color="blue">if </font>nPorts &gt; 0;
    <A HREF="Modelica_Blocks_Interfaces.html#Modelica.Blocks.Interfaces.RealInput"
>Modelica.Blocks.Interfaces.RealInput</A> portsData_height2[nPorts];
<font color="blue">equation </font>
  <font color="red">assert</font>(level &lt;= height, &quot;Tank starts to overflow (level = height = &quot; +<font color="red"> String</font>(level) + &quot;)&quot;);
  <font color="red">assert</font>(m&gt;=0, &quot;Mass in tank is zero&quot;);

  <font color="darkgreen">// Compute constant data</font>
  <font color="red">connect</font>(portsData_diameter, portsData_diameter2);
  <font color="red">connect</font>(portsData_height,portsData_height2);

  <font color="blue">for </font>i<font color="blue"> in </font>1:nPorts<font color="blue"> loop</font>
      bottomArea[i]=Constants.pi*(portsData_diameter2[i]/2)^2;
      ports_emptyPipeHysteresis[i] = portsData_diameter2[i]*hysteresisFactor;
  <font color="blue">end for</font>;

  <font color="darkgreen">// Only one connection allowed to a port to avoid unwanted ideal mixing</font>
<font color="darkgreen">/*
for i in 1:nTopPorts loop
  assert(cardinality(topPorts[i]) &lt;= 1,&quot;
topPorts[&quot; + String(i) + &quot;] of volume can at most be connected to one component.
If two or more connections are present, ideal mixing takes
place with these connections which is usually not the intention
of the modeller.
&quot;);
end for;

for i in 1:nPorts loop
  assert(cardinality(ports[i]) &lt;= 1,&quot;
ports[&quot; + String(i) + &quot;] of volume can at most be connected to one component.
If two or more connections are present, ideal mixing takes
place with these connections which is usually not the intention
of the modeller.
&quot;);
end for;
*/</font>

  <font color="darkgreen">// Total quantities</font>
  medium.p = p_ambient;
  V = crossArea*level + V0 <font color="darkgreen">&quot;Volume of fluid&quot;</font>;

  <font color="darkgreen">// Mass balances</font>
  mb_flow =<font color="red"> sum</font>(topPorts.m_flow) +<font color="red"> sum</font>(ports.m_flow);
  <font color="blue">for </font>i<font color="blue"> in </font>1:Medium.nXi<font color="blue"> loop</font>
    mbXi_flow[i] =<font color="red"> sum</font>(mXi_flow_top[:,i]) +<font color="red"> sum</font>(port_b_mXi_flow_bottom[:,i]);
  <font color="blue">end for</font>;
  <font color="blue">for </font>i<font color="blue"> in </font>1:Medium.nC<font color="blue"> loop</font>
    mbC_flow[i]  =<font color="red"> sum</font>(mC_flow_top[:,i])  +<font color="red"> sum</font>(port_b_mC_flow_bottom[:,i]);
  <font color="blue">end for</font>;

  <font color="darkgreen">// Energy balance</font>
  Hb_flow =<font color="red"> sum</font>(H_flow_top) +<font color="red"> sum</font>(port_b_H_flow_bottom);
  Qb_flow = heatTransfer.Q_flows[1];
  <font color="blue">if </font>Medium.singleState<font color="blue"> or </font>energyDynamics == Types.Dynamics.SteadyState<font color="blue"> then</font>
    Wb_flow = 0 <font color="darkgreen">
      &quot;Mechanical work is neglected, since also neglected in medium model (otherwise unphysical small temperature change, if tank level changes)&quot;</font>;
  <font color="blue">else</font>
    Wb_flow = -p_ambient*<font color="red">der</font>(V);
  <font color="blue">end if</font>;

  <font color="darkgreen">// Properties at top ports</font>
    <font color="blue">for </font>i<font color="blue"> in </font>1:nTopPorts<font color="blue"> loop</font>
    <font color="darkgreen">   // It is assumed that fluid flows only from one of the top ports in to the tank and never vice versa</font>
       H_flow_top[i]     = topPorts[i].m_flow*<font color="red">actualStream</font>(topPorts[i].h_outflow);
       mXi_flow_top[i,:] = topPorts[i].m_flow*<font color="red">actualStream</font>(topPorts[i].Xi_outflow);
       mC_flow_top[i,:]  = topPorts[i].m_flow*<font color="red">actualStream</font>(topPorts[i].C_outflow);
       topPorts[i].p     = p_ambient;
       topPorts[i].h_outflow = h_start;
       topPorts[i].Xi_outflow = X_start[1:Medium.nXi];
       topPorts[i].C_outflow  = C_start;
<font color="darkgreen">/*
       assert(topPorts[i].m_flow &gt; -1, &quot;Mass flows out of tank via topPorts[&quot; + String(i) + &quot;]\n&quot; +
                                         &quot;This indicates a wrong model&quot;);
*/</font>
    <font color="blue">end for</font>;

  <font color="darkgreen">// Properties at bottom ports</font>
    <font color="blue">for </font>i<font color="blue"> in </font>1:nPorts<font color="blue"> loop</font>
       port_b_H_flow_bottom[i]   = ports[i].m_flow*<font color="red">actualStream</font>(ports[i].h_outflow);
       port_b_mXi_flow_bottom[i,:] = ports[i].m_flow*<font color="red">actualStream</font>(ports[i].Xi_outflow);
       port_b_mC_flow_bottom[i,:]  = ports[i].m_flow*<font color="red">actualStream</font>(ports[i].C_outflow);
       aboveLevel[i] = level &gt;= (portsData_height2[i] + ports_emptyPipeHysteresis[i])<font color="blue">
                       or </font><font color="red">pre</font>(aboveLevel[i])<font color="blue"> and </font>level &gt;= (portsData_height2[i] - ports_emptyPipeHysteresis[i]);
       levelAbovePort[i] = <font color="blue">if </font>aboveLevel[i]<font color="blue"> then </font>level - portsData_height2[i]<font color="blue"> else </font>0;
       ports[i].h_outflow = medium.h;
       ports[i].Xi_outflow = medium.Xi;
       ports[i].C_outflow  = C;

       <font color="blue">if </font>stiffCharacteristicForEmptyPort<font color="blue"> then</font>
      <font color="darkgreen">    // If port is above fluid level, use large zeta if fluid flows out of port (= small mass flow rate)</font>
          zetas_out[i] = 1 + (<font color="blue">if </font>aboveLevel[i]<font color="blue"> then </font>0<font color="blue"> else </font>zetaLarge);
          ports[i].p = p_ambient + levelAbovePort[i]*system.g*medium.d
                               +<font color="red"> Modelica.Fluid.Utilities.regSquare2</font>(ports[i].m_flow, m_flow_small,
                                     <font color="red">lossConstant_D_zeta</font>(portsData_diameter2[i], 0.01)/medium.d,
                                     <font color="red">lossConstant_D_zeta</font>(portsData_diameter2[i], zetas_out[i])/medium.d);
          ports_m_flow_out[i] = false;

       <font color="blue">else</font>
      <font color="darkgreen">    // Handling according to Remelhe/Poschlad</font>
          ports_m_flow_out[i] = (<font color="red">pre</font>(ports_m_flow_out[i])<font color="blue"> and </font><font color="blue">not </font>ports[i].p&gt;p_ambient)<font color="blue">
                                     or </font>ports[i].m_flow &lt; -1e-6;
         <font color="blue">if </font>aboveLevel[i]<font color="blue"> then</font>
             ports[i].p = p_ambient + levelAbovePort[i]*system.g*medium.d -
                               <font color="red">smooth</font>(2,<font color="red">noEvent</font>(<font color="blue">if </font>ports[i].m_flow &lt; 0<font color="blue"> then </font>ports[i].m_flow^2/
                                     (2*medium.d*bottomArea[i]^2)<font color="blue"> else </font>0));
         <font color="blue">else</font>
            <font color="blue">if </font><font color="red">pre</font>(ports_m_flow_out[i])<font color="blue"> then</font>
               ports[i].m_flow = 0;
            <font color="blue">else</font>
               ports[i].p = p_ambient;
            <font color="blue">end if</font>;
         <font color="blue">end if</font>;
          zetas_out[i] =0;
       <font color="blue">end if</font>;
     <font color="blue">end for</font>;

<font color="blue">initial </font><font color="blue">equation </font>
    <font color="blue">for </font>i<font color="blue"> in </font>1:nPorts<font color="blue"> loop</font>
    <font color="red">   pre</font>(aboveLevel[i]) = level_start &gt;= portsData_height2[i];
    <font color="blue">end for</font>;

    <font color="blue">if </font>massDynamics == Types.Dynamics.FixedInitial<font color="blue"> then</font>
      level = level_start;
    <font color="blue">elseif </font>massDynamics == Types.Dynamics.SteadyStateInitial<font color="blue"> then</font>
    <font color="red">  der</font>(level) = 0;
    <font color="blue">end if</font>;


<font color="blue">equation </font>
<textblock type="annotconnect" expanded="false">  <font color="red">  connect</font>(heatPort, heatTransfer.heatPorts[1]);</textblock>
<textblock type="annotcomp" expanded="false"><font color="blue">end </font>TankWithTopPorts;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE HeatTransfer<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransferI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransfer" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransfer"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor</A>.HeatTransfer</H2>
<B>Wall heat transfer</B><p>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransferD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransfer">
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Ambient</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.CoefficientOfHeatTransfer"
>CoefficientOfHeatTransfer</A></TD><TD>k</TD><TD>0</TD><TD>Heat transfer coefficient to ambient [W/(m2.K)]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>T_ambient</TD><TD>system.T_ambient</TD><TD>Ambient temperature [K]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Internal Interface</B></TD></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD>Integer</TD><TD>n</TD><TD>1</TD><TD>Number of heat transfer segments</TD></TR>
<TR><TD>Boolean</TD><TD>use_k</TD><TD>false</TD><TD>= true to use k value for thermal isolation</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.HeatPorts_a"
>HeatPorts_a</A></TD><TD>heatPorts[n]</TD><TD>Heat port to component boundary</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">replaceable </font><font color="blue">model</font> HeatTransfer =
    <A HREF="Modelica_Fluid_Vessels_BaseClasses_HeatTransfer.html#Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer"
>Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer</A>
  <font color="blue">constrainedby </font>
  Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.PartialVesselHeatTransfer <font color="darkgreen">
  &quot;Wall heat transfer&quot;</font>;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE HeatTransfer<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransferI.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts.HeatTransfer" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts.HeatTransfer"></A><A HREF="Modelica_Fluid_Examples_AST_BatchPlant_BaseClasses.html#Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts"
>Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts</A>.HeatTransfer</H2>
<B>Wall heat transfer</B><p>
<IMG SRC="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWith3InletOutletArraysWithEvaporatorCondensor.HeatTransferD.png" ALT="Modelica.Fluid.Examples.AST_BatchPlant.BaseClasses.TankWithTopPorts.HeatTransfer">
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR bgcolor="#e0e0e0"><TD colspan=4>Ambient</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.CoefficientOfHeatTransfer"
>CoefficientOfHeatTransfer</A></TD><TD>k</TD><TD>0</TD><TD>Heat transfer coefficient to ambient [W/(m2.K)]</TD></TR>
<TR><TD><A HREF="Modelica_SIunits.html#Modelica.SIunits.Temperature"
>Temperature</A></TD><TD>T_ambient</TD><TD>system.T_ambient</TD><TD>Ambient temperature [K]</TD></TR>
<TR bgcolor="#c0c0c0"><TD colspan=4><B>Internal Interface</B></TD></TR>
<TR><TD colspan="2">replaceable package Medium</TD><TD><A HREF="Modelica_Media_Interfaces_PartialMedium.html#Modelica.Media.Interfaces.PartialMedium"
>PartialMedium</A></TD><TD>Medium in the component</TD></TR>
<TR><TD>Integer</TD><TD>n</TD><TD>1</TD><TD>Number of heat transfer segments</TD></TR>
<TR><TD>Boolean</TD><TD>use_k</TD><TD>false</TD><TD>= true to use k value for thermal isolation</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD><A HREF="Modelica_Fluid_Interfaces.html#Modelica.Fluid.Interfaces.HeatPorts_a"
>HeatPorts_a</A></TD><TD>heatPorts[n]</TD><TD>Heat port to component boundary</TD></TR>
</TABLE>
<P><H3>Modelica definition</H3>
<PRE>
<font color="blue">replaceable </font><font color="blue">model</font> HeatTransfer =
    <A HREF="Modelica_Fluid_Vessels_BaseClasses_HeatTransfer.html#Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer"
>Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.IdealHeatTransfer</A>
  <font color="blue">constrainedby </font>
  Modelica.Fluid.Vessels.BaseClasses.HeatTransfer.PartialVesselHeatTransfer <font color="darkgreen">
  &quot;Wall heat transfer&quot;</font>;
</PRE>
<HR>
<address><a href="http://www.3ds.com/">Automatically generated</a> Fri Nov 12 16:31:08 2010.
</address></BODY>
</HTML>
