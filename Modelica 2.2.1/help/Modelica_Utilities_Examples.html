<HTML>
<HEAD>
<TITLE>Modelica.Utilities.Examples</TITLE>
<META name="HTML-Generator" content="Dymola">
<META name="description" content="&quot;Examples to demonstrate the usage of package Modelica.Utilities&quot;">
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE Examples<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="Modelica.Utilities.Examples"></A><A HREF="Modelica_Utilities.html#Modelica.Utilities"
>Modelica.Utilities</A>.Examples</H2>
<B>Examples to demonstrate the usage of package Modelica.Utilities</B>
<P>
<H3>Information</H3>
<PRE></pre>
<p>
This package contains quite involved examples that demonstrate how to
use the functions of package Modelica.Utilities. In particular
the following examples are present.
</p>
<ul>
<li> Function <A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.calculator"
>calculator</a>
     is an interpreter to evaluate
     expressions consisting of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi.
     For example: calculator("1.5*sin(pi/6)"); <br>&nbsp;</li>
<li> Function <A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.expression"
>expression</a>
     is the basic function used in "calculator" to evaluate an expression.
     It is useful if the expression interpreter is used in a larger
     scan operation (such as readRealParameter below).<br>&nbsp;</li>
<li> Function <A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.readRealParameter"
>readRealParameter</a>
     reads the value of a parameter
     from file, given the file and the parameter name. The value
     on file is interpreted with the Examples.expression function
     and can therefore be an expression.<br>&nbsp;</li>
<li> Model <A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.readRealParameterModel"
>readRealParameterModel</a>
     is a test model to demonstrate the usage of "readRealParameter". The model
     contains 3 parameters that are read from file "Modelica.Utilities/data/Examples_readRealParameters.txt".
     </li>
</ul>
<pre></PRE><P>
<H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="Modelica.Utilities.Internal.mkdirS.png" ALT="Modelica.Utilities.Examples.calculator" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.calculator"
>calculator</A>
</TD><TD>Interpreter to evaluate simple expressions consisting of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi</TD></TR>
<TR><TD><IMG SRC="Modelica.Utilities.Internal.mkdirS.png" ALT="Modelica.Utilities.Examples.expression" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.expression"
>expression</A>
</TD><TD>Expression interpreter that returns with the position after the expression (expression may consist of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi</TD></TR>
<TR><TD><IMG SRC="Modelica.Utilities.Internal.mkdirS.png" ALT="Modelica.Utilities.Examples.readRealParameter" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.readRealParameter"
>readRealParameter</A>
</TD><TD>Read the value of a Real parameter from file</TD></TR>
<TR><TD><IMG SRC="Modelica.Utilities.Examples.readRealParameterModelS.png" ALT="Modelica.Utilities.Examples.readRealParameterModel" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.readRealParameterModel"
>readRealParameterModel</A>
</TD><TD>Demonstrate usage of Examples.readRealParameter/.expression</TD></TR>
</TABLE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE calculator<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Utilities.Examples.calculatorI.png" ALT="Modelica.Utilities.Examples.calculator" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Utilities.Examples.calculator"></A><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples"
>Modelica.Utilities.Examples</A>.calculator</H2>
<B>Interpreter to evaluate simple expressions consisting of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi</B><p>
<H3>Information</H3>
<PRE></pre>
<h3><font color="#008000">Syntax</font></h3>
<blockquote><pre>
result = <b>calculator</b>(expression);
</pre></blockquote>
<h3><font color="#008000">Description</font></h3>
<p>
This function demonstrates how a simple expression calculator
can be implemented in form of a recursive decent parser
using basically the Strings.scanToken(..) and Strings.scanDelimiter(..)
function.
</p>
<p>
The following operations are supported (pi=3.14.. is a predefined constant):
</p>
<pre>
   +, -
   *, /
   (expression)
   sin(expression)
   cos(expression)
   tan(expression)
   sqrt(expression)
   pi
</pre>
<h3><font color="#008000">Example</font></h3>
<blockquote><pre>
  calculator("2+3*(4-1)");  // returns 11
  calculator("sin(pi/6)");  // returns 0.5
</pre></blockquote>
<pre></PRE>
<H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>string</TD><TD>&nbsp;</TD><TD>Expression that is evaluated</TD></TR>
</TABLE>
<H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>result</TD><TD>Value of expression</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> calculator <font color="darkgreen">
  &quot;Interpreter to evaluate simple expressions consisting of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>.*;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;
  <font color="blue">input </font>String string <font color="darkgreen">&quot;Expression that is evaluated&quot;</font>;
  <font color="blue">output </font>Real result <font color="darkgreen">&quot;Value of expression&quot;</font>;
<font color="blue">protected </font>
  Integer nextIndex;
<font color="blue">algorithm </font>
  (result,nextIndex) :=<font color="red"> expression</font>(string, 1);
  <font color="red">Strings.scanNoToken</font>(string,nextIndex);
<font color="blue">end </font>calculator;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE expression<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Utilities.Examples.calculatorI.png" ALT="Modelica.Utilities.Examples.expression" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Utilities.Examples.expression"></A><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples"
>Modelica.Utilities.Examples</A>.expression</H2>
<B>Expression interpreter that returns with the position after the expression (expression may consist of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi</B><p>
<H3>Information</H3>
<PRE></pre>
<h3><font color="#008000">Syntax</font></h3>
<blockquote><pre>
             result = <b>expression</b>(string);
(result, nextIndex) = <b>expression</b>(string, startIndex=1, message="");
</pre></blockquote>
<h3><font color="#008000">Description</font></h3>
<p>
This function is nearly the same as Examples.<b>calculator</b>.
The essential difference is that function "expression" might be
used in other parsing operations: After the expression is
parsed and evaluated, the function returns with the value
of the expression as well as the position of the character
directly after the expression.
</p>
<p>
This function demonstrates how a simple expression calculator
can be implemented in form of a recursive decent parser
using basically the Strings.scanToken(..) and scanDelimiters(..)
function. There are 2 local functions (term, primary) that
implement the corresponding part of the grammar.
</p>
<p>
The following operations are supported (pi=3.14.. is a predefined constant):
</p>
<pre>
   +, -
   *, /
   (expression)
   sin(expression)
   cos(expression)
   tan(expression)
   sqrt(expression)
   pi
</pre>
<p>
The optional argument "startIndex" defines at which position
scanning of the expression starts.
</p>
<p>
In case of error,
the optional argument "message" is appended to the error
message, in order to give additional information where
the error occured.
</p>
<p>
This function parses the following grammaer
</p>
<pre>
  expression: [ add_op ] term { add_op term }
  add_op    : "+" | "-"
  term      : primary { mul_op primary }
  mul_op    : "*" | "/"
  primary   : UNSIGNED_NUMBER
              | pi
              | ( expression )
              | functionName( expression )
  function  :   sin
              | cos
              | tan
              | sqrt
</pre>
<p>
Note, in Examples.readRealParameter it is shown, how the expression
function can be used as part of another scan operation.
</p>
<h3><font color="#008000">Example</font></h3>
<blockquote><pre>
  expression("2+3*(4-1)");  // returns 11
  expression("sin(pi/6)");  // returns 0.5
</pre></blockquote>
<pre></PRE>
<H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>string</TD><TD>&nbsp;</TD><TD>Expression that is evaluated</TD></TR>
<TR><TD>&nbsp;</TD><TD>startIndex</TD><TD>1</TD><TD>Start scanning of expression at character startIndex</TD></TR>
<TR><TD>&nbsp;</TD><TD>message</TD><TD>&quot;&quot;</TD><TD>Message used in error message if scan is not successful</TD></TR>
</TABLE>
<H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>result</TD><TD>Value of expression</TD></TR>
<TR><TD>&nbsp;</TD><TD>nextIndex</TD><TD>Index after the scanned expression</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> expression <font color="darkgreen">
  &quot;Expression interpreter that returns with the position after the expression (expression may consist of +,-,*,/,(),sin(), cos(), tan(), sqrt(), pi&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_Utilities.html#Modelica.Utilities"
>Modelica.Utilities</A>.*;
  <font color="blue">import </font><A HREF="Modelica_Utilities_Types_TokenType.html#Modelica.Utilities.Types.TokenType"
>Modelica.Utilities.Types.TokenType</A>;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;
  <font color="blue">input </font>String string <font color="darkgreen">&quot;Expression that is evaluated&quot;</font>;
  <font color="blue">input </font>Integer startIndex=1 <font color="darkgreen">
    &quot;Start scanning of expression at character startIndex&quot;</font>;
  <font color="blue">input </font>String message=&quot;&quot; <font color="darkgreen">
    &quot;Message used in error message if scan is not successful&quot;</font>;
  <font color="blue">output </font>Real result <font color="darkgreen">&quot;Value of expression&quot;</font>;
  <font color="blue">output </font>Integer nextIndex <font color="darkgreen">&quot;Index after the scanned expression&quot;</font>;

<font color="blue">protected </font>
<font color="blue">encapsulated </font><font color="blue">function</font> term <font color="darkgreen">&quot;Evaluate term of an expression&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_Utilities_Types.html#Modelica.Utilities.Types"
>Modelica.Utilities.Types</A>;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.expression.primary"
>Modelica.Utilities.Examples.expression.primary</A>;
    <font color="blue">import </font><A HREF="Modelica_Icons.html#Modelica.Icons"
>Modelica.Icons</A>;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Function"
>Icons.Function</A>;
  <font color="blue">input </font>String string;
  <font color="blue">input </font>Integer startIndex;
  <font color="blue">input </font>String message=&quot;&quot;;
  <font color="blue">output </font>Real result;
  <font color="blue">output </font>Integer nextIndex;
  <font color="blue">protected </font>
  Real result2;
  Boolean scanning=true;
  String operator;
<font color="blue">algorithm </font>
  <font color="darkgreen">// scan for &quot;primary * primary&quot; or &quot;primary / primary&quot;</font>
  (result, nextIndex) :=<font color="red"> primary</font>(string, startIndex, message);
  <font color="blue">while </font>scanning<font color="blue"> loop</font>
    (operator, nextIndex) :=<font color="red"> Strings.scanDelimiter</font>(
                                    string, nextIndex, {&quot;*&quot;,&quot;/&quot;,&quot;&quot;}, message);
    <font color="blue">if </font>operator == &quot;&quot;<font color="blue"> then</font>
       scanning := false;
    <font color="blue">else</font>
       (result2, nextIndex) :=<font color="red"> primary</font>(string, nextIndex, message);
       result := <font color="blue">if </font>operator == &quot;*&quot;<font color="blue"> then </font>result*result2<font color="blue"> else </font>result/result2;
    <font color="blue">end if</font>;
  <font color="blue">end while</font>;
<font color="blue">end </font>term;

<font color="blue">encapsulated </font><font color="blue">function</font> primary <font color="darkgreen">&quot;Evaluate primary of an expression&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_Math.html#Modelica.Math"
>Modelica.Math</A>;
    <font color="blue">import </font><A HREF="Modelica_Constants.html#Modelica.Constants"
>Modelica.Constants</A>;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Types.html#Modelica.Utilities.Types"
>Modelica.Utilities.Types</A>;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>.*;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.expression"
>Modelica.Utilities.Examples.expression</A>;
    <font color="blue">import </font><A HREF="Modelica_Icons.html#Modelica.Icons"
>Modelica.Icons</A>;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Function"
>Icons.Function</A>;

  <font color="blue">input </font>String string;
  <font color="blue">input </font>Integer startIndex;
  <font color="blue">input </font>String message=&quot;&quot;;
  <font color="blue">output </font>Real result;
  <font color="blue">output </font>Integer nextIndex;
  <font color="blue">protected </font>
  <A HREF="Modelica_Utilities_Types.html#Modelica.Utilities.Types.TokenValue"
>Types.TokenValue</A> token;
  Real result2;
  String delimiter;
  String functionName;
  Real pi = Constants.pi;
<font color="blue">algorithm </font>
  (token,nextIndex) :=<font color="red"> scanToken</font>(string, startIndex,unsigned=true);
  <font color="blue">if </font>token.tokenType == Types.TokenType.DelimiterToken<font color="blue"> and </font>token.string == &quot;(&quot;<font color="blue"> then</font>
    (result,nextIndex) :=<font color="red"> expression</font>(string, nextIndex,message);
    (delimiter,nextIndex) :=<font color="red"> scanDelimiter</font>(string,nextIndex,{&quot;)&quot;}, message);

  <font color="blue">elseif </font>token.tokenType == Types.TokenType.RealToken<font color="blue"> then</font>
    result := token.real;

  <font color="blue">elseif </font>token.tokenType == Types.TokenType.IntegerToken<font color="blue"> then</font>
    result := token.integer;

  <font color="blue">elseif </font>token.tokenType == Types.TokenType.IdentifierToken<font color="blue"> then</font>
    <font color="blue">if </font>token.string == &quot;pi&quot;<font color="blue"> then</font>
       result := pi;
    <font color="blue">else</font>
       functionName := token.string;
       (delimiter,nextIndex) :=<font color="red"> scanDelimiter</font>(string,nextIndex,{&quot;(&quot;}, message);
       (result,nextIndex)    :=<font color="red"> expression</font>(string, nextIndex, message);
       (delimiter,nextIndex) :=<font color="red"> scanDelimiter</font>(string,nextIndex,{&quot;)&quot;}, message);
       <font color="blue">if </font>functionName == &quot;sin&quot;<font color="blue"> then</font>
         result :=<font color="red"> Math.sin</font>(result);
       <font color="blue">elseif </font>functionName == &quot;cos&quot;<font color="blue"> then</font>
         result :=<font color="red"> Math.cos</font>(result);
       <font color="blue">elseif </font>functionName == &quot;tan&quot;<font color="blue"> then</font>
         result :=<font color="red"> Math.tan</font>(result);
       <font color="blue">elseif </font>functionName == &quot;sqrt&quot;<font color="blue"> then</font>
         <font color="blue">if </font>result &lt; 0.0<font color="blue"> then</font>
            <font color="red">syntaxError</font>(string, startIndex, &quot;Argument of call \&quot;sqrt(&quot; +<font color="red"> String</font>(result) + &quot;)\&quot; is negative.\n&quot; +
                        &quot;Imaginary numbers are not supported by the calculator.\n&quot; + message);
         <font color="blue">end if</font>;
         result :=<font color="red"> sqrt</font>(result);
       <font color="blue">else</font>
         <font color="red">syntaxError</font>(string, startIndex, &quot;Function \&quot;&quot; + functionName + &quot;\&quot; is unknown (not supported)\n&quot; +
                                         message);
       <font color="blue">end if</font>;
    <font color="blue">end if</font>;

  <font color="blue">else</font>
    <font color="red">syntaxError</font>(string, startIndex, &quot;Invalid primary of expression.\n&quot; + message);
  <font color="blue">end if</font>;
<font color="blue">end </font>primary;

  Real result2;
  String signOfNumber;
  Boolean scanning=true;
  String operator;
<font color="blue">algorithm </font>
  <font color="darkgreen">// scan for optional leading &quot;+&quot; or &quot;-&quot; sign</font>
  (signOfNumber, nextIndex) :=<font color="red">Strings.scanDelimiter</font>(
                                   string, startIndex, {&quot;+&quot;,&quot;-&quot;,&quot;&quot;}, message);

  <font color="darkgreen">// scan for &quot;term + term&quot; or &quot;term - term&quot;</font>
  (result, nextIndex) :=<font color="red"> term</font>(string, nextIndex, message);
  <font color="blue">if </font>signOfNumber == &quot;-&quot;<font color="blue"> then</font>
     result := -result;
  <font color="blue">end if</font>;

  <font color="blue">while </font>scanning<font color="blue"> loop</font>
    (operator, nextIndex) :=<font color="red"> Strings.scanDelimiter</font>(
                                    string, nextIndex, {&quot;+&quot;,&quot;-&quot;,&quot;&quot;}, message);
    <font color="blue">if </font>operator == &quot;&quot;<font color="blue"> then</font>
       scanning := false;
    <font color="blue">else</font>
       (result2, nextIndex) :=<font color="red"> term</font>(string, nextIndex, message);
       result := <font color="blue">if </font>operator == &quot;+&quot;<font color="blue"> then </font>result+result2<font color="blue"> else </font>result-result2;
    <font color="blue">end if</font>;
  <font color="blue">end while</font>;
<font color="blue">end </font>expression;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE readRealParameter<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Utilities.Examples.calculatorI.png" ALT="Modelica.Utilities.Examples.readRealParameter" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Utilities.Examples.readRealParameter"></A><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples"
>Modelica.Utilities.Examples</A>.readRealParameter</H2>
<B>Read the value of a Real parameter from file</B><p>
<H3>Information</H3>
<PRE></pre>
<h3><font color="#008000">Syntax</font></h3>
<blockquote><pre>
result = <b>readRealParameter</b>(fileName, name);
</pre></blockquote>
<h3><font color="#008000">Description</font></h3>
<p>
This function demonstrates how a function can be implemented
that reads the value of a parameter from file. The function
performs the following actions:
</p>
<ol>
<li> It opens file "fileName" and reads the lines of the file.</li>
<li> In every line, Modelica line comments ("// ... end-of-line")
     are skipped </li>
<li> If a line consists of "name = expression" and the "name"
     in this line is identical to the second argument "name"
     of the function call, the expression calculator Examples.expression
     is used to evaluate the expression after the "=" character.
     The expression can optionally be terminated with a ";".</li>
<li> The result of the expression evaluation is returned as
     the value of the parameter "name". </li>
</ol>
<h3><font color="#008000">Example</font></h3>
<p>
On file "test.txt" the following lines might be present:
</p>
<blockquote><pre>
// Motor data
J        = 2.3     // inertia
w_rel0   = 1.5*2;  // relative angular velocity
phi_rel0 = pi/3
</pre></blockquote>
<p>
The function returns the value "3.0" when called as:
</p>
<blockquote><pre>
readRealParameter("test.txt", "w_rel0")
</pre></blockquote>
<pre></PRE>
<H3>Inputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>fileName</TD><TD>&nbsp;</TD><TD>Name of file</TD></TR>
<TR><TD>&nbsp;</TD><TD>name</TD><TD>&nbsp;</TD><TD>Name of parameter</TD></TR>
</TABLE>
<H3>Outputs</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>result</TD><TD>Actual value of parameter on file</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">function</font> readRealParameter <font color="darkgreen">
  &quot;Read the value of a Real parameter from file&quot;</font>
  <font color="blue">import </font><A HREF="Modelica_Utilities.html#Modelica.Utilities"
>Modelica.Utilities</A>.*;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Function"
>Modelica.Icons.Function</A>;
  <font color="blue">input </font>String fileName <font color="darkgreen">&quot;Name of file&quot;</font>;
  <font color="blue">input </font>String name <font color="darkgreen">&quot;Name of parameter&quot;</font>;
  <font color="blue">output </font>Real result <font color="darkgreen">&quot;Actual value of parameter on file&quot;</font>;
<font color="blue">protected </font>
  String line;
  String identifier;
  String delimiter;
  Integer nextIndex;
  Integer iline=1;
  <A HREF="Modelica_Utilities_Types.html#Modelica.Utilities.Types.TokenValue"
>Types.TokenValue</A> token;
  String message = &quot;in file \&quot;&quot; + fileName + &quot;\&quot; on line &quot;;
  String message2;
  Boolean found = false;
  Boolean endOfFile=false;
<font color="blue">algorithm </font>
 (line, endOfFile) :=<font color="red">Streams.readLine</font>(fileName, iline);

  <font color="blue">while </font><font color="blue">not </font>found<font color="blue"> and </font><font color="blue">not </font>endOfFile<font color="blue"> loop</font>
    (token, nextIndex) :=<font color="red"> Strings.scanToken</font>(line);
     <font color="blue">if </font>token.tokenType == Types.TokenType.NoToken<font color="blue"> then</font>
      <font color="darkgreen">  // skip line</font>
        iline := iline + 1;
     <font color="blue">elseif </font>token.tokenType == Types.TokenType.IdentifierToken<font color="blue"> then</font>
        <font color="blue">if </font>token.string == name<font color="blue"> then</font>
        <font color="darkgreen">   // name found, get value of &quot;name = value;&quot;</font>
           message2 := message +<font color="red"> String</font>(iline);
           (delimiter,nextIndex) :=<font color="red"> Strings.scanDelimiter</font>(line, nextIndex, {&quot;=&quot;}, message2);
           (result,nextIndex)    :=<font color="red"> Examples.expression</font>(line, nextIndex, message2);
           (delimiter,nextIndex) :=<font color="red"> Strings.scanDelimiter</font>(line, nextIndex, {&quot;;&quot;, &quot;&quot;}, message2);
        <font color="red">   Strings.scanNoToken</font>(line, nextIndex, message2);
           found := true;
        <font color="blue">else</font>
        <font color="darkgreen">   // wrong name, skip line</font>
           iline := iline + 1;
        <font color="blue">end if</font>;
     <font color="blue">else</font>
      <font color="darkgreen">  // wrong token</font>
      <font color="red">  Strings.syntaxError</font>(line, nextIndex, &quot;Expected identifier &quot; + message +<font color="red"> String</font>(iline));
     <font color="blue">end if</font>;

    <font color="darkgreen"> // read next line</font>
     (line, endOfFile) :=<font color="red">Streams.readLine</font>(fileName, iline);
  <font color="blue">end while</font>;

  <font color="blue">if </font><font color="blue">not </font>found<font color="blue"> then</font>
    <font color="red"> Streams.error</font>(&quot;Parameter \&quot;&quot; + name + &quot;\&quot; not found in file \&quot;&quot; + fileName + &quot;\&quot;&quot;);
  <font color="blue">end if</font>;
<font color="blue">end </font>readRealParameter;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE readRealParameterModel<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Utilities.Examples.readRealParameterModelI.png" ALT="Modelica.Utilities.Examples.readRealParameterModel" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Utilities.Examples.readRealParameterModel"></A><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples"
>Modelica.Utilities.Examples</A>.readRealParameterModel</H2>
<B>Demonstrate usage of Examples.readRealParameter/.expression</B><p>
<H3>Information</H3>
<PRE></pre>
<p>
Model that shows the usage of Examples.readRealParameter and Examples.expression.
The model has 3 parameters and the values of these parameters are read
from a file.
</p>
<pre></PRE>
<H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Type</TH><TH>Name</TH><TH>Default</TH><TH>Description</TH></TR>
<TR><TD>&nbsp;</TD><TD>file</TD><TD>classDirectory() + &quot;data/Exa...</TD><TD>File on which data is present</TD></TR>
<TR><TD>&nbsp;</TD><TD>J</TD><TD>readRealParameter(file, &quot;J&quot;)</TD><TD>[kg.m2]</TD></TR>
<TR><TD>&nbsp;</TD><TD>phi_rel0</TD><TD>readRealParameter(file, &quot;phi...</TD><TD>[rad]</TD></TR>
<TR><TD>&nbsp;</TD><TD>w_rel0</TD><TD>readRealParameter(file, &quot;w_r...</TD><TD>[rad/s]</TD></TR>
</TABLE>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">model</font> readRealParameterModel <font color="darkgreen">
  &quot;Demonstrate usage of Examples.readRealParameter/.expression&quot;</font>
  <font color="blue">import </font>SI = <A HREF="Modelica_SIunits.html#Modelica.SIunits"
>Modelica.SIunits</A>;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Example"
>Modelica.Icons.Example</A>;

  <font color="blue">parameter </font>String file =<font color="red"> classDirectory</font>() + &quot;data/Examples_readRealParameters.txt&quot; <font color="darkgreen">
    &quot;File on which data is present&quot;</font>;
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Inertia"
>SI.Inertia</A> J =<font color="red">              readRealParameter</font>(file, &quot;J&quot;);
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.Angle"
>SI.Angle</A> phi_rel0 =<font color="red">         readRealParameter</font>(file, &quot;phi_rel0&quot;);
  <font color="blue">parameter </font><A HREF="Modelica_SIunits.html#Modelica.SIunits.AngularVelocity"
>SI.AngularVelocity</A> w_rel0 =<font color="red"> readRealParameter</font>(file, &quot;w_rel0&quot;);
<font color="blue">equation </font>

<font color="blue">end </font>readRealParameterModel;
</PRE>
<HR>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE primary<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="Modelica.Utilities.Examples.expression.primaryI.png" ALT="Modelica.Utilities.Examples.expression.primary" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="Modelica.Utilities.Examples.expression.primary"></A><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.expression"
>Modelica.Utilities.Examples.expression</A>.primary</H2>
<B>Evaluate primary of an expression</B><p>
<H3>Modelica definition</H3>
<PRE>
<font color="blue">encapsulated </font><font color="blue">function</font> primary <font color="darkgreen">&quot;Evaluate primary of an expression&quot;</font>
    <font color="blue">import </font><A HREF="Modelica_Math.html#Modelica.Math"
>Modelica.Math</A>;
    <font color="blue">import </font><A HREF="Modelica_Constants.html#Modelica.Constants"
>Modelica.Constants</A>;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Types.html#Modelica.Utilities.Types"
>Modelica.Utilities.Types</A>;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Strings.html#Modelica.Utilities.Strings"
>Modelica.Utilities.Strings</A>.*;
    <font color="blue">import </font><A HREF="Modelica_Utilities_Examples.html#Modelica.Utilities.Examples.expression"
>Modelica.Utilities.Examples.expression</A>;
    <font color="blue">import </font><A HREF="Modelica_Icons.html#Modelica.Icons"
>Modelica.Icons</A>;
  <font color="blue">extends </font><A HREF="Modelica_Icons.html#Modelica.Icons.Function"
>Icons.Function</A>;

  <font color="blue">input </font>String string;
  <font color="blue">input </font>Integer startIndex;
  <font color="blue">input </font>String message=&quot;&quot;;
  <font color="blue">output </font>Real result;
  <font color="blue">output </font>Integer nextIndex;
<font color="blue">protected </font>
  <A HREF="Modelica_Utilities_Types.html#Modelica.Utilities.Types.TokenValue"
>Types.TokenValue</A> token;
  Real result2;
  String delimiter;
  String functionName;
  Real pi = Constants.pi;
<font color="blue">algorithm </font>
  (token,nextIndex) :=<font color="red"> scanToken</font>(string, startIndex,unsigned=true);
  <font color="blue">if </font>token.tokenType == Types.TokenType.DelimiterToken<font color="blue"> and </font>token.string == &quot;(&quot;<font color="blue"> then</font>
    (result,nextIndex) :=<font color="red"> expression</font>(string, nextIndex,message);
    (delimiter,nextIndex) :=<font color="red"> scanDelimiter</font>(string,nextIndex,{&quot;)&quot;}, message);

  <font color="blue">elseif </font>token.tokenType == Types.TokenType.RealToken<font color="blue"> then</font>
    result := token.real;

  <font color="blue">elseif </font>token.tokenType == Types.TokenType.IntegerToken<font color="blue"> then</font>
    result := token.integer;

  <font color="blue">elseif </font>token.tokenType == Types.TokenType.IdentifierToken<font color="blue"> then</font>
    <font color="blue">if </font>token.string == &quot;pi&quot;<font color="blue"> then</font>
       result := pi;
    <font color="blue">else</font>
       functionName := token.string;
       (delimiter,nextIndex) :=<font color="red"> scanDelimiter</font>(string,nextIndex,{&quot;(&quot;}, message);
       (result,nextIndex)    :=<font color="red"> expression</font>(string, nextIndex, message);
       (delimiter,nextIndex) :=<font color="red"> scanDelimiter</font>(string,nextIndex,{&quot;)&quot;}, message);
       <font color="blue">if </font>functionName == &quot;sin&quot;<font color="blue"> then</font>
         result :=<font color="red"> Math.sin</font>(result);
       <font color="blue">elseif </font>functionName == &quot;cos&quot;<font color="blue"> then</font>
         result :=<font color="red"> Math.cos</font>(result);
       <font color="blue">elseif </font>functionName == &quot;tan&quot;<font color="blue"> then</font>
         result :=<font color="red"> Math.tan</font>(result);
       <font color="blue">elseif </font>functionName == &quot;sqrt&quot;<font color="blue"> then</font>
         <font color="blue">if </font>result &lt; 0.0<font color="blue"> then</font>
          <font color="red">  syntaxError</font>(string, startIndex, &quot;Argument of call \&quot;sqrt(&quot; +<font color="red"> String</font>(result) + &quot;)\&quot; is negative.\n&quot; +
                        &quot;Imaginary numbers are not supported by the calculator.\n&quot; + message);
         <font color="blue">end if</font>;
         result :=<font color="red"> sqrt</font>(result);
       <font color="blue">else</font>
        <font color="red"> syntaxError</font>(string, startIndex, &quot;Function \&quot;&quot; + functionName + &quot;\&quot; is unknown (not supported)\n&quot; +
                                         message);
       <font color="blue">end if</font>;
    <font color="blue">end if</font>;

  <font color="blue">else</font>
    <font color="red">syntaxError</font>(string, startIndex, &quot;Invalid primary of expression.\n&quot; + message);
  <font color="blue">end if</font>;
<font color="blue">end </font>primary;
</PRE>
<HR>
<address>HTML-documentation generated by <a href="http://www.dynasim.se/">Dymola</a> Tue Mar 28 11:40:58 2006.
</address></BODY>
</HTML>
